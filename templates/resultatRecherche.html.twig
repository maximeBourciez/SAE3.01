{% extends "base_template.html.twig" %}

{% block title %}Résultat de la recherche
{% endblock %}

{% block content %}
	<div class="container-fluid px-4">
		<h2 class="search-results-title text-center">"{{ recherche }}"</h2>

		{% set sections = {
            'Films correspondants': { 'items': contenus, 'type': 'contenu', 'methode': 'afficherContenu', 'imageKey': 'lienAfficheReduite' },
            'Séries correspondantes': { 'items': series, 'type': 'serie','methode' : 'afficherSerie', 'imageKey': 'lienAfficheReduite' },
            'Collections correspondantes': { 'items': collections, 'type': 'collection', 'methode' : 'afficherCollection', 'imageKey': 'lienAffiche' }
        } %}

		{% for title, data in sections %}
			{% if data.items|length > 0 %}
				<div>
					<div class="section-header d-flex justify-content-between align-items-center">
						<h2>{{ title }}</h2>
						<span class="results-count">({{ data.items|length }}
							résultats)</span>
					</div>
					<div class="d-flex flex-column">
						<div id="{{ data.type }}-container" class="content-container">
							{% for item in data.items|slice(0, 5) %}
								<div class="content-item bg-mydark my-2 shadow rounded">
									<div class="d-flex">
										<a href="index.php?controller={{data.type}}&methode={{data.methode}}&tmdb_id={{ item.id }}">
											<img src="{{ attribute(item, data.imageKey) }}" class="rounded float-start m-2" alt="{{ item.titre }}" style="width: 100px; height: 150px;" loading="lazy" crossorigin="anonymous" referrerpolicy="no-referrer" onerror="this.src='images/no-image.svg'">
										</a>
										<div class="d-flex flex-column text-white my-2 ms-3">
											<h3>{{ item.titre }}</h3>
											<p class="d-none d-md-block">{{ item.description|length > 250 ? item.description|slice(0, 250) ~ '...' : item.description }}</p>
											<a href="index.php?controller={{data.type}}&methode={{data.methode}}&tmdb_id={{ item.id }}" class="btn btn-myprimary">Voir plus</a>
										</div>
									</div>
									{% if not loop.last %}
										<hr class="text-white m-0 p-0">
									{% endif %}
								</div>
							{% endfor %}
						</div>
						{% if data.items|length > 5 %}
							<div class="text-center py-3 d-flex justify-content-center">
								<button class="btn btn-myprimary load-more-btn me-2" data-container="{{ data.type }}-container" data-total="{{ data.items|length }}" data-loaded="5">
									Afficher
									<i class="bi bi-plus"></i>
								</button>
								<button class="btn btn-myprimary load-less-btn" data-container="{{ data.type }}-container">
									Afficher
									<i class="bi bi-dash"></i>
								</button>
							</div>
						{% endif %}
					</div>
				</div>

				<!-- Template pour chargement dynamique -->
				<div id="{{ data.type }}-template" style="display: none;">
					{% for item in data.items|slice(5) %}
						<div class="content-item d-none">
							<div class="d-flex">
								<a href="index.php?controller={{data.type}}&methode={{data.methode}}&tmdb_id={{ item.id }}">
									<img src="{{ attribute(item, data.imageKey) }}" class="rounded float-start m-2" alt="{{ item.titre }}" style="width: 100px; height: 150px;" loading="lazy" crossorigin="anonymous" referrerpolicy="no-referrer" onerror="this.src='images/no-image.svg'">
								</a>
								<div class="d-flex flex-column text-white my-2 ms-3">
									<h3>{{ item.titre }}</h3>
									<p class="d-none d-md-block">{{ item.description|length > 250 ? item.description|slice(0, 250) ~ '...' : item.description }}</p>
									<a href="index.php?controller={{data.type}}&methode={{data.methode}}&tmdb_id={{ item.id }}" class="btn btn-myprimary">Voir plus</a>
								</div>
							</div>
						</div>
					{% endfor %}
				</div>
			{% endif %}
		{% endfor %}
	</div>
{% endblock %}

{% block script %}
	<script src="js/loadMore.js"></script>
{% endblock %}
